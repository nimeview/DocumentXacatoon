use actix_web::{web, HttpResponse};
use image::{DynamicImage, ImageBuffer, ImageOutputFormat};
use crate::connection_server::get_tile;
use std::io::Cursor;
use serde::Deserialize;
use serde_json::json;

#[derive(Deserialize)]
pub struct UpLoadIcon {
    pub _type: String,
    pub name: String,
}
#[derive(Deserialize)]
pub struct UpLoadTile {
    pub _type: String,
    pub tile_name: String,
    pub x: u32,
    pub y: u32,
}
/*
pub async fn upload_icon(data: web::Json<UpLoadIcon>){
    println!("Upload _type: {:?}", data._type);
    let response = match get_tile(data.name.to_string()).await {
        Ok(binary_data) => binary_data,
        Err(_) => return HttpResponse::InternalServerError().body("Failed to get tile data"),
    };

    let image = match ImageBuffer::from_raw(1024, 1024, response) {
        Some(buffer) => DynamicImage::ImageRgb8(buffer),
        None => {
            return HttpResponse::InternalServerError().body("Failed to create image from binary data");
        }
    };

    let mut png_data = Vec::new();
    if image.write_to(&mut Cursor::new(&mut png_data), ImageOutputFormat::Png).is_err() {
        return HttpResponse::InternalServerError().body("Failed to convert image to TIFF");
    }

}
*/
pub async fn upload_tile(data: web::Json<UpLoadTile>) -> HttpResponse {
    println!("Upload _type: {:?}", data._type);
    let response:Vec<u8> = vec![137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 1, 80, 0, 0, 0, 166, 8, 6, 0, 0, 0, 140, 84, 215, 105, 0, 0, 18, 61, 73, 68, 65, 84, 120, 1, 237, 192, 3, 160, 36, 89, 150, 198, 241, 255, 119, 238, 141, 200, 204, 167, 114, 75, 99, 174, 109, 219, 182, 109, 219, 182, 109, 219, 182, 109, 105, 140, 158, 150, 74, 175, 158, 50, 51, 34, 238, 249, 118, 183, 106, 122, 166, 135, 59, 107, 213, 175, 62, 244, 161, 15, 53, 87, 93, 117, 213, 85, 87, 253, 107, 81, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 46, 22, 11, 174, 186, 234, 170, 171, 174, 250, 87, 163, 114, 213, 85, 87, 93, 117, 213, 191, 5, 117, 185, 92, 114, 213, 255, 29, 139, 197, 2, 128, 229, 114, 201, 85, 87, 93, 245, 159, 138, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 254, 95, 123, 159, 247, 250, 0, 78, 157, 60, 5, 64, 102, 242, 149, 95, 243, 165, 252, 127, 240, 138, 175, 240, 42, 188, 230, 171, 191, 22, 247, 123, 202, 83, 159, 204, 79, 255, 236, 79, 112, 213, 85, 255, 10, 84, 174, 250, 127, 233, 193, 15, 122, 8, 159, 245, 25, 159, 207, 43, 188, 220, 43, 113, 191, 204, 228, 43, 191, 230, 75, 249, 191, 238, 125, 223, 251, 3, 121, 255, 247, 249, 32, 118, 118, 142, 113, 191, 223, 254, 221, 223, 228, 167, 127, 246, 39, 184, 234, 170, 127, 5, 42, 255, 131, 156, 58, 117, 154, 83, 39, 78, 2, 96, 224, 214, 103, 60, 157, 113, 28, 185, 234, 63, 214, 91, 190, 249, 219, 240, 145, 31, 254, 113, 92, 119, 237, 117, 252, 127, 243, 149, 95, 246, 117, 188, 254, 235, 190, 17, 17, 193, 85, 87, 253, 59, 81, 249, 31, 32, 162, 112, 203, 205, 183, 112, 252, 216, 113, 30, 168, 150, 202, 56, 142, 92, 245, 31, 231, 83, 63, 233, 51, 120, 187, 183, 125, 103, 102, 253, 12, 128, 221, 221, 139, 100, 38, 39, 79, 158, 226, 255, 178, 87, 124, 133, 87, 225, 211, 62, 249, 51, 121, 216, 67, 31, 193, 253, 158, 242, 212, 39, 243, 240, 135, 61, 130, 171, 174, 250, 55, 34, 248, 111, 182, 88, 44, 120, 244, 35, 31, 205, 241, 99, 199, 1, 104, 173, 113, 213, 127, 158, 55, 124, 253, 55, 101, 214, 207, 0, 120, 194, 19, 31, 199, 71, 124, 204, 7, 115, 238, 252, 89, 254, 175, 123, 189, 215, 121, 125, 30, 246, 208, 71, 0, 176, 92, 45, 249, 174, 239, 249, 54, 126, 248, 71, 127, 128, 171, 174, 250, 119, 32, 248, 111, 246, 136, 135, 61, 146, 190, 239, 1, 184, 251, 158, 187, 121, 234, 211, 159, 194, 85, 255, 185, 166, 105, 226, 231, 126, 225, 167, 121, 251, 119, 126, 75, 254, 234, 175, 255, 130, 255, 46, 31, 246, 33, 31, 197, 223, 253, 229, 147, 249, 187, 191, 124, 50, 159, 249, 105, 159, 199, 127, 133, 59, 239, 186, 131, 79, 255, 204, 79, 226, 43, 190, 250, 75, 248, 183, 186, 249, 166, 91, 248, 230, 111, 248, 78, 126, 247, 55, 254, 132, 95, 250, 185, 223, 228, 99, 62, 242, 19, 184, 234, 255, 37, 42, 255, 205, 36, 49, 142, 35, 183, 222, 118, 43, 135, 135, 7, 44, 22, 27, 92, 245, 159, 231, 190, 179, 247, 242, 237, 223, 245, 205, 124, 255, 15, 126, 15, 255, 19, 72, 2, 64, 226, 63, 213, 48, 12, 252, 225, 31, 253, 30, 159, 245, 185, 159, 198, 221, 247, 220, 197, 191, 199, 123, 189, 199, 251, 242, 234, 175, 250, 154, 0, 156, 60, 121, 138, 119, 121, 167, 247, 224, 199, 127, 242, 71, 184, 253, 142, 219, 184, 234, 255, 21, 42, 255, 205, 118, 119, 47, 114, 231, 93, 119, 50, 181, 137, 171, 254, 243, 189, 227, 187, 190, 53, 255, 31, 125, 197, 87, 127, 9, 255, 81, 110, 184, 254, 70, 30, 104, 99, 99, 131, 71, 61, 242, 49, 220, 126, 199, 109, 92, 245, 255, 10, 193, 127, 179, 103, 220, 254, 12, 166, 54, 113, 213, 85, 255, 91, 252, 234, 175, 255, 50, 227, 56, 114, 191, 167, 60, 245, 201, 252, 250, 111, 254, 10, 87, 253, 191, 67, 229, 170, 171, 174, 250, 87, 249, 233, 159, 253, 9, 158, 126, 235, 211, 120, 211, 55, 126, 115, 206, 95, 56, 207, 183, 126, 251, 55, 114, 213, 255, 75, 84, 174, 186, 234, 191, 192, 123, 191, 231, 251, 241, 225, 31, 242, 49, 60, 80, 68, 112, 191, 183, 126, 203, 183, 231, 45, 222, 236, 109, 120, 160, 31, 254, 209, 239, 231, 203, 191, 234, 139, 249, 159, 232, 111, 254, 246, 175, 248, 155, 191, 253, 43, 174, 250, 127, 141, 202, 85, 87, 253, 23, 40, 165, 50, 159, 207, 121, 65, 186, 174, 163, 235, 58, 30, 168, 235, 58, 174, 186, 234, 127, 48, 42, 87, 93, 245, 95, 224, 111, 255, 246, 175, 249, 141, 223, 250, 85, 64, 220, 239, 250, 235, 110, 224, 177, 143, 121, 49, 0, 158, 240, 196, 199, 113, 231, 93, 119, 242, 64, 79, 122, 242, 19, 185, 234, 170, 255, 193, 168, 92, 117, 213, 127, 129, 63, 251, 139, 63, 225, 207, 254, 226, 79, 120, 160, 15, 251, 144, 143, 226, 177, 143, 121, 49, 0, 254, 238, 239, 255, 134, 207, 249, 252, 207, 224, 170, 171, 254, 23, 161, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 95, 237, 37, 94, 252, 37, 185, 254, 186, 27, 0, 184, 247, 190, 123, 249, 155, 191, 253, 43, 174, 250, 127, 135, 202, 85, 87, 93, 245, 175, 246, 161, 31, 252, 81, 188, 198, 171, 189, 22, 0, 255, 240, 184, 191, 231, 157, 222, 237, 173, 185, 234, 255, 29, 42, 255, 205, 54, 54, 54, 0, 113, 191, 249, 124, 206, 253, 54, 55, 55, 81, 4, 247, 91, 46, 143, 176, 205, 85, 255, 118, 159, 252, 9, 159, 206, 53, 215, 92, 203, 3, 93, 123, 205, 117, 0, 72, 226, 43, 191, 236, 235, 120, 160, 159, 253, 185, 159, 226, 183, 127, 247, 55, 249, 207, 240, 212, 167, 62, 133, 63, 254, 147, 63, 4, 224, 137, 79, 122, 34, 255, 153, 94, 231, 181, 95, 159, 183, 120, 179, 183, 226, 129, 78, 158, 60, 197, 253, 30, 116, 203, 131, 249, 202, 47, 251, 58, 238, 119, 239, 189, 247, 240, 37, 95, 254, 5, 188, 32, 215, 95, 119, 61, 247, 187, 253, 142, 103, 112, 213, 255, 75, 84, 254, 155, 61, 226, 97, 143, 68, 18, 207, 207, 77, 55, 222, 204, 3, 253, 253, 227, 254, 142, 105, 154, 184, 234, 223, 238, 141, 223, 240, 205, 56, 125, 250, 12, 207, 143, 36, 222, 240, 245, 223, 132, 7, 250, 155, 191, 253, 43, 254, 179, 252, 242, 175, 254, 2, 191, 252, 171, 191, 192, 127, 133, 87, 126, 197, 87, 225, 13, 95, 255, 77, 120, 65, 30, 242, 224, 135, 242, 144, 7, 63, 148, 251, 61, 245, 105, 79, 225, 133, 57, 115, 250, 26, 238, 247, 247, 255, 240, 183, 92, 245, 255, 18, 193, 127, 51, 219, 188, 168, 108, 115, 213, 85, 255, 221, 94, 234, 37, 95, 134, 99, 199, 142, 3, 48, 142, 35, 191, 242, 171, 191, 196, 85, 255, 47, 161, 135, 62, 244, 161, 230, 170, 255, 51, 22, 139, 5, 0, 203, 229, 146, 171, 254, 115, 124, 192, 251, 125, 8, 31, 245, 225, 31, 7, 192, 237, 119, 220, 198, 155, 188, 197, 235, 114, 213, 255, 75, 84, 174, 186, 234, 170, 127, 149, 135, 62, 244, 225, 220, 239, 25, 183, 221, 202, 85, 255, 111, 81, 185, 234, 170, 171, 254, 85, 110, 188, 225, 38, 238, 247, 228, 39, 63, 145, 171, 254, 223, 162, 114, 213, 85, 87, 253, 171, 92, 115, 230, 26, 0, 108, 243, 123, 127, 240, 187, 92, 245, 255, 22, 149, 171, 174, 186, 234, 95, 229, 235, 190, 225, 171, 216, 218, 218, 166, 181, 137, 63, 253, 179, 63, 226, 170, 255, 183, 208, 67, 31, 250, 80, 115, 213, 255, 25, 139, 197, 2, 128, 229, 114, 201, 85, 87, 93, 245, 159, 138, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 234, 98, 177, 224, 170, 255, 123, 22, 139, 5, 87, 93, 117, 213, 127, 42, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 242, 63, 76, 41, 133, 190, 239, 89, 46, 151, 92, 245, 63, 215, 219, 191, 205, 59, 242, 86, 111, 249, 118, 0, 252, 234, 175, 255, 50, 223, 247, 3, 223, 197, 85, 87, 253, 63, 67, 229, 127, 128, 197, 98, 193, 91, 190, 229, 91, 242, 152, 71, 63, 154, 19, 39, 78, 80, 74, 97, 111, 111, 143, 187, 239, 190, 155, 159, 255, 133, 95, 224, 233, 79, 127, 58, 87, 253, 207, 242, 144, 135, 62, 156, 71, 63, 234, 177, 0, 252, 237, 223, 255, 13, 87, 93, 245, 255, 16, 149, 255, 102, 199, 143, 31, 231, 99, 62, 250, 163, 57, 115, 230, 12, 15, 116, 252, 248, 113, 142, 31, 63, 206, 195, 31, 254, 112, 126, 228, 71, 127, 148, 63, 252, 195, 63, 228, 170, 171, 174, 186, 234, 127, 16, 42, 255, 205, 222, 241, 29, 223, 145, 51, 103, 206, 0, 240, 244, 167, 63, 157, 63, 251, 243, 63, 103, 189, 94, 243, 152, 71, 63, 154, 151, 125, 217, 151, 165, 235, 58, 222, 234, 45, 223, 146, 39, 60, 225, 9, 92, 184, 112, 129, 171, 174, 186, 234, 170, 255, 33, 168, 252, 55, 218, 220, 220, 228, 37, 95, 226, 37, 0, 120, 218, 211, 159, 206, 151, 127, 249, 151, 115, 191, 63, 250, 163, 63, 98, 255, 224, 128, 215, 121, 237, 215, 102, 123, 123, 155, 151, 121, 153, 151, 225, 55, 126, 227, 55, 184, 234, 191, 199, 135, 126, 208, 71, 242, 10, 47, 255, 74, 220, 239, 216, 177, 227, 220, 239, 85, 94, 233, 213, 248, 174, 111, 251, 1, 158, 219, 15, 252, 208, 247, 242, 235, 191, 249, 43, 60, 183, 157, 157, 99, 124, 212, 135, 127, 28, 143, 120, 248, 35, 57, 125, 234, 12, 198, 220, 121, 231, 29, 60, 245, 233, 79, 225, 151, 127, 229, 23, 248, 155, 191, 253, 43, 158, 219, 215, 126, 213, 55, 179, 189, 181, 205, 159, 255, 197, 159, 242, 160, 91, 30, 204, 139, 189, 216, 75, 176, 183, 119, 137, 223, 254, 157, 223, 224, 55, 126, 235, 215, 249, 176, 15, 249, 40, 30, 245, 136, 71, 51, 140, 3, 127, 244, 199, 191, 207, 151, 124, 249, 23, 240, 64, 111, 247, 214, 239, 192, 155, 191, 217, 91, 3, 240, 107, 191, 241, 203, 92, 184, 112, 158, 215, 120, 245, 215, 225, 209, 143, 122, 12, 155, 155, 155, 156, 61, 119, 150, 191, 250, 171, 63, 227, 43, 191, 230, 203, 184, 234, 170, 23, 17, 149, 255, 70, 143, 120, 196, 35, 136, 8, 0, 254, 228, 143, 255, 152, 231, 246, 27, 191, 241, 27, 188, 206, 107, 191, 54, 0, 215, 94, 123, 45, 87, 253, 247, 185, 249, 230, 91, 120, 241, 23, 123, 73, 158, 159, 155, 111, 186, 133, 155, 111, 186, 133, 231, 118, 242, 228, 73, 158, 219, 235, 191, 238, 27, 241, 145, 31, 254, 177, 92, 127, 221, 13, 60, 208, 53, 103, 174, 229, 101, 94, 250, 229, 120, 205, 87, 127, 29, 62, 247, 11, 62, 131, 63, 249, 211, 63, 228, 129, 30, 243, 168, 199, 114, 252, 248, 9, 110, 185, 249, 65, 236, 236, 28, 3, 224, 154, 51, 215, 114, 203, 205, 15, 230, 101, 94, 250, 229, 121, 185, 151, 125, 5, 238, 247, 246, 111, 251, 206, 172, 215, 107, 190, 250, 235, 190, 156, 251, 93, 123, 237, 245, 188, 248, 139, 189, 36, 0, 231, 47, 156, 227, 149, 95, 241, 213, 152, 205, 102, 220, 239, 212, 201, 211, 60, 250, 145, 143, 225, 81, 143, 124, 44, 31, 244, 97, 239, 195, 85, 87, 189, 8, 8, 254, 27, 29, 28, 28, 240, 171, 191, 250, 171, 252, 234, 175, 254, 42, 79, 120, 226, 19, 121, 110, 146, 176, 13, 64, 87, 43, 87, 253, 247, 57, 56, 60, 224, 226, 197, 11, 92, 188, 120, 129, 139, 23, 47, 112, 120, 120, 192, 253, 214, 235, 53, 23, 47, 94, 224, 226, 197, 11, 92, 188, 120, 129, 139, 23, 47, 112, 225, 194, 121, 46, 92, 184, 192, 115, 251, 144, 15, 252, 112, 174, 191, 238, 6, 0, 238, 59, 123, 47, 191, 247, 7, 191, 195, 239, 252, 222, 111, 113, 231, 93, 119, 0, 112, 205, 153, 107, 248, 156, 207, 252, 2, 94, 234, 37, 95, 134, 231, 103, 103, 231, 24, 127, 254, 151, 127, 202, 31, 255, 233, 31, 98, 39, 125, 223, 243, 114, 47, 251, 10, 252, 197, 95, 253, 25, 127, 252, 39, 127, 64, 102, 2, 240, 90, 175, 249, 186, 188, 32, 175, 249, 234, 175, 67, 223, 119, 60, 249, 41, 79, 228, 137, 79, 122, 60, 135, 71, 135, 220, 239, 101, 95, 230, 229, 249, 144, 15, 252, 8, 174, 186, 234, 69, 64, 229, 191, 209, 83, 158, 242, 20, 158, 242, 148, 167, 240, 130, 188, 196, 75, 188, 4, 146, 0, 120, 218, 211, 158, 198, 85, 255, 125, 190, 224, 139, 62, 155, 47, 224, 179, 185, 223, 39, 124, 220, 167, 242, 142, 111, 247, 46, 0, 252, 204, 207, 255, 36, 95, 246, 21, 95, 200, 191, 228, 163, 62, 252, 227, 184, 229, 150, 7, 3, 240, 196, 39, 63, 129, 143, 254, 216, 15, 229, 220, 249, 179, 220, 239, 91, 190, 225, 187, 120, 217, 151, 121, 121, 78, 157, 60, 205, 235, 191, 238, 27, 242, 55, 127, 251, 87, 60, 183, 11, 23, 206, 243, 33, 31, 254, 126, 0, 252, 204, 143, 255, 18, 55, 220, 112, 19, 187, 187, 23, 249, 224, 15, 123, 95, 0, 126, 242, 71, 127, 129, 155, 111, 186, 133, 19, 39, 78, 242, 130, 72, 226, 91, 191, 253, 27, 249, 182, 239, 252, 102, 0, 118, 118, 142, 241, 49, 31, 249, 9, 188, 249, 155, 190, 21, 0, 175, 251, 58, 175, 207, 55, 125, 235, 215, 113, 213, 85, 255, 2, 130, 255, 161, 186, 174, 227, 213, 94, 245, 85, 1, 104, 173, 241, 183, 127, 247, 119, 92, 245, 191, 219, 67, 31, 250, 48, 238, 247, 189, 223, 247, 157, 156, 59, 127, 150, 7, 250, 250, 111, 250, 106, 90, 107, 0, 60, 226, 225, 143, 226, 249, 57, 123, 254, 44, 247, 187, 247, 190, 123, 1, 56, 119, 254, 44, 247, 187, 247, 190, 123, 0, 232, 106, 199, 11, 242, 132, 39, 62, 142, 111, 251, 206, 111, 230, 126, 123, 123, 151, 248, 156, 207, 255, 116, 118, 119, 47, 2, 112, 226, 196, 41, 174, 186, 234, 69, 64, 240, 63, 212, 59, 191, 243, 59, 115, 227, 141, 55, 2, 240, 55, 127, 243, 55, 92, 186, 116, 137, 171, 254, 119, 187, 230, 204, 181, 0, 172, 215, 107, 126, 245, 215, 127, 137, 231, 246, 119, 127, 255, 55, 236, 237, 95, 2, 224, 166, 27, 111, 230, 69, 101, 243, 175, 114, 215, 221, 119, 242, 252, 92, 220, 189, 8, 192, 246, 214, 54, 87, 93, 245, 34, 160, 242, 63, 208, 107, 191, 214, 107, 241, 202, 175, 244, 74, 0, 236, 238, 238, 242, 19, 63, 249, 147, 92, 245, 191, 95, 223, 207, 0, 40, 165, 240, 195, 223, 255, 147, 60, 63, 27, 139, 77, 0, 106, 215, 241, 159, 101, 185, 92, 242, 252, 140, 211, 8, 128, 36, 174, 186, 234, 69, 64, 229, 127, 152, 87, 124, 197, 87, 228, 109, 223, 246, 109, 145, 196, 114, 181, 226, 187, 191, 251, 187, 185, 120, 241, 34, 87, 253, 223, 81, 107, 229, 97, 15, 125, 4, 87, 93, 245, 191, 28, 149, 255, 65, 94, 234, 165, 94, 138, 119, 125, 151, 119, 161, 214, 202, 48, 12, 252, 224, 15, 254, 32, 79, 122, 242, 147, 185, 234, 255, 150, 204, 228, 119, 126, 247, 55, 121, 97, 206, 158, 63, 203, 85, 87, 253, 15, 71, 229, 127, 136, 71, 63, 250, 209, 188, 231, 123, 188, 7, 125, 223, 51, 77, 19, 63, 252, 195, 63, 204, 95, 252, 197, 95, 112, 213, 255, 29, 153, 9, 192, 114, 181, 228, 19, 63, 245, 99, 248, 239, 18, 17, 60, 63, 66, 92, 117, 213, 191, 2, 193, 255, 0, 15, 121, 200, 67, 120, 223, 247, 121, 31, 22, 139, 5, 173, 53, 126, 236, 199, 127, 156, 63, 254, 147, 63, 225, 170, 255, 91, 46, 92, 60, 15, 192, 230, 198, 38, 47, 246, 216, 151, 224, 191, 203, 169, 83, 167, 121, 126, 118, 182, 119, 0, 88, 173, 86, 92, 117, 213, 139, 128, 224, 191, 217, 141, 55, 222, 200, 251, 191, 255, 251, 179, 181, 181, 69, 102, 242, 83, 63, 253, 211, 252, 222, 239, 253, 30, 87, 253, 207, 182, 90, 46, 185, 223, 131, 31, 244, 16, 94, 20, 247, 222, 123, 15, 247, 123, 159, 247, 122, 127, 158, 219, 71, 124, 232, 199, 240, 7, 191, 253, 23, 252, 225, 239, 252, 5, 223, 241, 45, 223, 199, 127, 150, 23, 123, 204, 139, 243, 98, 143, 125, 9, 30, 232, 205, 222, 228, 45, 57, 125, 250, 12, 0, 187, 151, 46, 114, 213, 85, 47, 2, 42, 255, 141, 54, 55, 55, 249, 192, 15, 248, 0, 78, 28, 63, 14, 192, 223, 255, 253, 223, 179, 92, 46, 121, 149, 87, 121, 21, 158, 219, 238, 238, 46, 143, 127, 252, 227, 185, 234, 127, 134, 191, 127, 220, 223, 113, 191, 151, 125, 233, 151, 231, 59, 190, 229, 251, 56, 123, 238, 62, 30, 232, 235, 191, 241, 171, 185, 227, 206, 219, 185, 223, 207, 255, 194, 207, 240, 90, 175, 241, 186, 108, 108, 108, 240, 154, 175, 254, 218, 124, 195, 215, 126, 27, 127, 248, 71, 191, 71, 223, 207, 120, 204, 163, 30, 203, 43, 191, 242, 171, 209, 247, 61, 0, 79, 126, 202, 147, 248, 207, 178, 185, 185, 197, 151, 124, 225, 87, 242, 139, 191, 244, 115, 44, 87, 75, 94, 230, 165, 95, 142, 23, 127, 236, 75, 80, 74, 1, 224, 73, 79, 126, 2, 87, 93, 245, 34, 160, 242, 223, 104, 103, 103, 135, 51, 103, 206, 112, 191, 151, 124, 201, 151, 228, 37, 95, 242, 37, 121, 126, 238, 189, 239, 62, 62, 231, 115, 62, 135, 171, 254, 103, 248, 173, 223, 254, 117, 254, 234, 111, 254, 146, 151, 121, 169, 151, 165, 214, 202, 75, 190, 196, 75, 243, 220, 190, 239, 7, 190, 155, 59, 238, 188, 157, 251, 253, 233, 159, 255, 49, 63, 247, 11, 63, 197, 59, 190, 253, 187, 32, 5, 175, 248, 242, 175, 204, 43, 190, 252, 43, 243, 220, 158, 250, 180, 167, 240, 237, 223, 249, 205, 252, 103, 185, 239, 236, 189, 92, 123, 205, 117, 188, 207, 123, 125, 0, 207, 109, 111, 111, 143, 111, 254, 214, 111, 224, 170, 171, 94, 4, 4, 87, 93, 245, 111, 244, 153, 159, 253, 201, 252, 230, 111, 255, 26, 23, 46, 94, 32, 51, 121, 32, 219, 172, 215, 107, 158, 219, 151, 127, 213, 23, 243, 213, 95, 247, 229, 220, 115, 207, 221, 216, 230, 129, 14, 14, 246, 249, 245, 223, 252, 21, 62, 254, 147, 62, 146, 115, 231, 207, 242, 162, 106, 217, 248, 215, 248, 147, 63, 253, 35, 254, 232, 79, 254, 128, 105, 154, 184, 159, 109, 158, 126, 235, 83, 249, 172, 207, 253, 20, 158, 242, 212, 39, 113, 213, 85, 47, 2, 244, 98, 47, 246, 98, 230, 170, 255, 23, 62, 251, 51, 190, 128, 71, 60, 252, 145, 188, 168, 12, 124, 203, 183, 125, 3, 191, 247, 251, 191, 205, 127, 134, 199, 60, 250, 177, 188, 204, 75, 191, 28, 165, 84, 238, 184, 243, 118, 254, 226, 47, 255, 140, 189, 189, 75, 252, 103, 248, 208, 15, 250, 72, 222, 231, 189, 62, 0, 128, 159, 255, 197, 159, 225, 115, 62, 255, 211, 121, 169, 151, 124, 25, 94, 252, 197, 94, 146, 174, 171, 252, 197, 95, 254, 57, 127, 247, 247, 127, 195, 243, 243, 217, 159, 241, 5, 60, 226, 225, 143, 228, 69, 101, 224, 91, 190, 237, 27, 248, 189, 223, 255, 109, 174, 250, 63, 141, 202, 85, 255, 111, 220, 114, 243, 131, 120, 228, 35, 30, 205, 191, 198, 45, 55, 223, 194, 127, 150, 199, 63, 225, 113, 60, 254, 9, 143, 227, 191, 154, 36, 0, 254, 230, 111, 255, 138, 191, 249, 219, 191, 226, 95, 114, 203, 205, 15, 226, 145, 143, 120, 52, 255, 26, 183, 220, 124, 11, 87, 253, 159, 71, 229, 170, 255, 55, 158, 250, 180, 39, 131, 196, 191, 198, 249, 243, 231, 248, 255, 238, 169, 79, 123, 50, 72, 252, 107, 156, 63, 127, 142, 171, 254, 207, 163, 114, 213, 255, 27, 95, 240, 197, 159, 195, 85, 255, 122, 95, 240, 197, 159, 195, 85, 87, 61, 31, 84, 174, 186, 234, 255, 129, 11, 23, 207, 243, 212, 167, 61, 5, 128, 251, 238, 187, 151, 171, 174, 250, 15, 128, 94, 236, 197, 94, 204, 92, 117, 213, 85, 87, 93, 245, 175, 69, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 117, 185, 92, 114, 213, 255, 29, 139, 197, 2, 128, 229, 114, 201, 85, 87, 93, 245, 159, 138, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 80, 185, 234, 170, 171, 174, 186, 234, 223, 130, 202, 85, 87, 93, 117, 213, 85, 255, 22, 84, 174, 186, 234, 170, 171, 174, 250, 183, 160, 114, 213, 85, 87, 93, 117, 213, 191, 5, 149, 171, 174, 186, 234, 170, 171, 254, 45, 168, 92, 117, 213, 85, 87, 93, 245, 111, 65, 229, 170, 171, 174, 186, 234, 170, 127, 11, 42, 87, 93, 117, 213, 85, 87, 253, 91, 240, 143, 237, 112, 246, 178, 197, 42, 215, 85, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130];

    let image = match ImageBuffer::from_raw(1024, 1024, response) {
        Some(buffer) => DynamicImage::ImageRgb8(buffer),
        None => {
            return HttpResponse::InternalServerError().body("Failed to create image from binary data");
        }
    };

    let mut png_data = Vec::new();
    if image.write_to(&mut Cursor::new(&mut png_data), ImageOutputFormat::Png).is_err() {
        return HttpResponse::InternalServerError().body("Failed to convert image to TIFF");
    }

    HttpResponse::Ok().header("Content-Type", "application/json").finish()
}